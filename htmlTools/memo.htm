<!DOCTYPE html>
<html lang="ja">

<head>
	<meta charset="UTF-8">
	<meta name="author" content="Geppaku">
	<link rel="icon" href="../favicon.ico">
	<title>Memo</title>
	<!--　■■■■■　CSS　■■■■■　-->
	<style type="text/css">
		html, body, div, p, pre {
			margin: 0;
			padding: 0;
			border: 0;
			font-size: 100%;
			font: inherit;
			vertical-align: baseline;
		}
		html, body {
			height: 100%;
		}
		button, input, select, textarea, pre {
			font-family: inherit;
			font-size: 100%;
		}
		pre {
			display: inline;
		}
		.l--gap--1rem {
			gap: 1rem;
		}
		.l--flex-container {
			display: flex;
		}
		.l--flex-container--column {
			display: flex;
			flex-direction: column;
		}
		.l--align-items--center {
			align-items: center;
		}
		.l--flex--1 {
			flex: 1;
		}
		.d--highlight {
			background-color: yellow;
		}
		.d--width--4rem {
			width: 4rem;
		}
		.l--grid-container--body {
			display: grid;
			height: 100%;
			grid:
				"info header" auto
				"menu main" 1fr
				/auto 1fr;
		}
		.header {
			grid-area: header;
			position: sticky;
			top: 0;
			z-index: 20;
		}
		.menu {
			grid-area: menu;
			left: 0;
			position: sticky;
		}
		.main {
			grid-area: main;
			border: 1px solid;
			overflow: auto;
		}
		#main {
			#line-number {
				padding: 0.25rem 0.25rem 0.25rem 0.5rem;
				text-align: right;
				color :grey;
				border-right: 1px solid grey;
			}
			#memo {
				width: 100%;
				padding: 0.25rem 0.5rem;
			}
		}
	</style>
</head>

<body>
	<div class="l--grid-container--body">
		<div class="info l--flex-container--column l--align-items--center">
			<div id="line-count"></div>
			<div id="string-count"></div>
		</div>
		<header class="header">
			<div class="l--flex-container">
				<input type="text" id="search-str" class="l--flex--1">
				<button class="a--event-speaker d--width--4rem" data-act="search">検索</button>
			</div>
			<div class="l--flex-container">
				<input type="text" id="replace-str" class="l--flex--1">
				<button class="a--event-speaker d--width--4rem" data-act="replace">置換</button>
			</div>
			<div class="l--flex-container">
				<div class="l--flex-container l--gap--1rem l--flex--1">
					<label><input type="checkbox" id="regex" checked>正規表現</label>
					<label><input type="checkbox" id="case-sensitive">大/小文字を区別</label>
					<label><input type="checkbox" id="replace-all" checked>全て検索/置換</label>
					<label><input type="checkbox" id="search-line" checked>複数行検索/置換</label>
				</div>
				<div class="l--flex-container">
					<button class="a--event-speaker d--width--4rem" data-act="grep">Grep</button>
				</div>
			</div>
		</header>
		<div class="menu l--flex-container--column">
			<button class="a--event-speaker" data-act="copy">Copy</button>
			<button class="a--event-speaker" data-act="fang">Fang</button>
			<button class="a--event-speaker" data-act="defang">Defang</button>
			<hr>
			<button class="a--event-speaker" data-act="del-blank-line">空行削除</button>
			<button class="a--event-speaker" data-act="del-dup-line">重複行削除</button>
			<button class="a--event-speaker" data-act="asc-sort">昇順ソート</button>
			<button class="a--event-speaker" data-act="des-sort">降順ソート</button>
			<button class="a--event-speaker" data-act="del-head-space">行頭空白削除</button>
			<button class="a--event-speaker" data-act="del-end-space">行末空白削除</button>
			<hr>
			<button class="a--event-speaker" data-act="extract10">約10行抽出</button>
			<button class="a--event-speaker" data-act="transform-matrix">行→列(CSV)</button>
		</div>
		<main id="main" class="main l--flex-container">
			<div id="line-number"></div>
			<div id="memo" contenteditable></div>
		</main>
	</div>
	<!--　■■■■■　JavaScript　■■■■■　-->
	<script type="text/javascript">
		memoElm = document.getElementById('memo');
		countLineStr();
		window.onload = function() {
			memoElm.addEventListener('input', countLineStr);
			document.querySelectorAll('.a--event-speaker').forEach(function(elm) {
				elm.addEventListener('click', function() {
					switch ( elm.dataset.act ) {
						case 'search':
							search();
							break;
						case 'replace':
							replace();
							break;
						case 'grep' :
							grep();
							break;
						case 'copy' :
							copy();
							break;
						case 'fang' :
							fang();
							break;
						case 'defang' :
							defang();
							break;
						case 'del-blank-line' :
							delBlankLine();
						case 'del-dup-line' :
							delDupLine();
							break;
						case 'asc-sort' :
							ascSort();
							break;
						case 'des-sort' :
							desSort();
							break;
						case 'del-head-space' :
							delHeadSpace();
							break;
						case 'del-end-space' :
							delEndSpace();
							break;
						case 'extract10' :
							extract10();
							break;
						case 'transform-matrix' :
							transformMatrix();
							break;
					}
				countLineStr();
				});
			});
		}
		function countLineStr() {
			let lineCount = memoElm.innerText.match(/\r?\n/g);
			lineCount = lineCount==null ? 1 : lineCount.length+1;
			let lineNumber = '';
			for ( let i=1; i<=lineCount; i++) {
				lineNumber += i + '\n';
			}
			let stringCount = memoElm.innerText.length;
			document.getElementById('line-number').innerText = lineNumber;
			document.getElementById('line-count').innerText = lineCount + '行';
			document.getElementById('string-count').innerText = stringCount + '文字';
		}
		function search() {
			let searchStr = document.getElementById('regex').checked ? document.getElementById('search-str').value : RegExp.escape(document.getElementById('search-str').value);
			let flag = document.getElementById('case-sensitive').checked ? '' : 'i';
			flag += document.getElementById('replace-all').checked ? 'g' : '';
			let outputStrs = [];
			if ( document.getElementById('search-line').checked ) {
				let lines = memoElm.innerText.split(/\n/);
				for ( let line of lines ) {
					let replaceStr = '<span class="d--highlight">' + JSON.parse( "\"" + '$1' + "\"") + '</span>';
					line = line.replace(new RegExp('('+searchStr+')', flag), replaceStr);
					outputStrs.push(line);
				}
			} else {
				let replaceStr = '<span class="d--highlight">' + JSON.parse( "\"" + '$1' + "\"") + '</span>';
				let outputStr = memoElm.innerText.replace(new RegExp('('+searchStr+')', flag), replaceStr);
				outputStrs.push(outputStr);
			}
			memoElm.innerHTML = outputStrs.join('<br>');
		}
		function replace() {
			let searchStr = document.getElementById('regex').checked ? document.getElementById('search-str').value : RegExp.escape(document.getElementById('search-str').value);
			let flag = document.getElementById('case-sensitive').checked ? '' : 'i';
			flag += document.getElementById('replace-all').checked ? 'g' : '';
			flag += document.getElementById('search-line').checked ? 'm' : '';
			let outputStrs = [];
			let replaceStr = JSON.parse( "\"" + document.getElementById('replace-str').value.replace(/"/g,'\\"') + "\"");
			memoElm.innerText = memoElm.innerText.replace(new RegExp(searchStr, flag), replaceStr);
		}
		function grep() {
			let searchStr = document.getElementById('regex').checked ? document.getElementById('search-str').value : RegExp.escape(document.getElementById('search-str').value);
			let flag = document.getElementById('case-sensitive').checked ? '' : 'i';
			flag += document.getElementById('replace-all').checked ? 'g' : '';
			let outputStrs = [];
			let lines = memoElm.innerText.split(/\n/);
			for ( let line of lines ) {
				if ( line.match(new RegExp(searchStr, flag))!==null ) {
					let replaceStr = '<span class="d--highlight">' + JSON.parse( "\"" + '$1' + "\"") + '</span>';
					line = line.replace(new RegExp('('+searchStr+')', flag), replaceStr);
					outputStrs.push(line);
				}
			memoElm.innerHTML = outputStrs.join('<br>');
			}
		}
		function copy() {
			navigator.clipboard.writeText(memoElm.innerText);
		}
		function fang() {
			memoElm.innerText = memoElm.innerText.replace(/h[tx][tx]p(s?)\[?:\]?\/\//g, 'http$1://').replace(/\[\.\]/g,'.').replace(/\[dot\]/g,'.');
		}
		function defang() {
			memoElm.innerText = memoElm.innerText.replace(/http(s?):\/\//g, 'hxxp$1[:]//').replace(/\./g,'[.]');
		}
		function delBlankLine() {
			let lines = memoElm.innerText.split(/\n/);
			let outputLines = lines.filter(item => item.match(/^[\s]*$/)==null);
			memoElm.innerText = outputLines.join('\n');
		}
		function delDupLine() {
			let lines = memoElm.innerText.split(/\n/);
			lines = [...new Set(lines)];
			memoElm.innerText = lines.join('\n');
		}
		function ascSort() {
			let lines = memoElm.innerText.split(/\n/);
			lines.sort((a,b) => (a < b ? -1 : 1));
			memoElm.innerText = lines.join('\n');
		}
		function desSort() {
			let lines = memoElm.innerText.split(/\n/);
			lines.sort((a,b) => (a > b ? -1 : 1));
			memoElm.innerText = lines.join('\n');
		}
		function delHeadSpace() {
			let lines = memoElm.innerText.split(/\n/);
			let outputLines = [];
			for ( let line of lines ) {
				outputLines.push(line.replace(/^\s*/,''));
			}
			memoElm.innerText = outputLines.join('\n');
		}
		function delEndSpace() {
			let lines = memoElm.innerText.split(/\n/);
			let outputLines = [];
			for ( let line of lines ) {
				outputLines.push(line.replace(/\s*$/,''));
			}
			memoElm.innerText = outputLines.join('\n');
		}
		function extract10() {
			let lines = memoElm.innerText.split(/\n/);
			let span = Math.ceil(lines.length/10);
			let outputLines = [];
			for ( let i=0; i<lines.length; i=i+span ) {
				console.log()
				outputLines.push(lines[i]);
			}
			memoElm.innerText = outputLines.join('\n');
		}
		function transformMatrix() {
			let lines = memoElm.innerText.split(/\n/);
			let outputLines = [];
			for ( let line of lines ) {
				outputLines.push('"' + line + '"');
			}
			memoElm.innerText = outputLines.join(',');;
		}
	</script>
</body>

</html>