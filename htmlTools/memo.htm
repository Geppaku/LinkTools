<!DOCTYPE html>
<html lang="ja">

<head>
	<meta charset="UTF-8">
	<meta name="author" content="Geppaku">
	<link rel="icon" href="../favicon.ico">
	<title>開発中</title>
	<!--　■■■■■　CSS　■■■■■　-->
	<style type="text/css">
		html, body, div, p, pre {
			margin: 0;
			padding: 0;
			border: 0;
			font-size: 100%;
			font: inherit;
			vertical-align: baseline;
		}
		html, body {
			height: 100%;
		}
		button, input, select, textarea, pre {
			font-family: inherit;
			font-size: 100%;
		}
		pre {
			display: inline;
		}
		.l--gap--1rem {
			gap: 1rem;
		}
		.l--flex-container {
			display: flex;
		}
		.l--flex-container--column{
			display: flex;
			flex-direction: column;
		}
		.l--flex--1 {
			flex: 1;
		}
		.d--highlight {
			background-color: yellow;
		}
		.l--grid-container--body {
			display: grid;
			height: 100%;
			grid:
				"info header" auto
				"menu main" 1fr
				/auto 1fr;
		}
		.header {
			grid-area: header;
			position: sticky;
			top: 0;
			z-index: 20;
		}
		.menu {
			grid-area: menu;
		}
		.main {
			grid-area: main;
			height: 99%;
			overflow: auto;
			border: 1px solid;
		}
		#ln {
			padding: 0.25rem 0.25rem 0.25rem 0.5rem;
			text-align: right;
			color :grey;
			border-right: 1px solid grey;
		}
		#memo {
			width: 100%;
			padding: 0.25rem 0.5rem;
		}
	</style>
</head>

<body>
	<div class="l--grid-container--body">
		<div class="info"><h1>開発中</h1></div>
		<header class="header">
			<div class="l--flex-container">
				<input type="text" id="search-str" class="l--flex--1">
				<button class="a--event-speaker" data-act="search">検索</button>
			</div>
			<div class="l--flex-container">
				<input type="text" id="replace-str" class="l--flex--1">
				<button class="a--event-speaker" data-act="replace">置換</button>
			</div>
			<div class="l--flex-container">
				<div class="l--flex-container l--gap--1rem l--flex--1">
					<label><input type="checkbox" id="regex" checked>正規表現</label>
					<label><input type="checkbox" id="case-sensitive">大/小文字を区別</label>
					<label><input type="checkbox" id="replace-all" checked>全て検索/置換</label>
					<label><input type="checkbox" id="search-line" checked>各行検索/置換</label>
				</div>
				<div class="l--flex-container">
					<button class="a--event-speaker" data-act="grep">Grep</button>
				</div>
			</div>
		</header>
		<div class="menu l--flex-container--column">
			<button class="a--event-speaker" data-act="fang">Fang</button>
			<button class="a--event-speaker" data-act="defang">Defang</button>
			<button class="a--event-speaker" data-act="del-dup-line">重複行削除</button>
			<button class="a--event-speaker" data-act="asc-sort">昇順ソート</button>
			<button class="a--event-speaker" data-act="des-sort">降順ソート</button>
			<button class="a--event-speaker" data-act="del-head-space">行頭空白削除</button>
			<button class="a--event-speaker" data-act="del-end-space">行末空白削除</button>
		</div>
		<main class="main l--flex-container">
			<div id="ln">1</div>
			<div id="memo" contenteditable>hogehoge<br>fugafuga<br>piyopiyo<br>http://www.example.com<br>https://www.example.com<br>192.0.2.0</div>
		</main>
	</div>
	<!--　■■■■■　JavaScript　■■■■■　-->
	<script type="text/javascript">
		memoElm = document.getElementById('memo');
		window.onload = function() {
			document.querySelectorAll('.a--event-speaker').forEach(function(elm) {
				elm.addEventListener('click', function() {
					switch ( elm.dataset.act ) {
						case 'search':
							search();
							break;
						case 'replace':
							replace();
							break;
						case 'grep' :
							grep();
							break;
						case 'fang' :
							fang();
							break;
						case 'defang' :
							defang();
							break;
						case 'del-dup-line' :
							delDupLine();
							break;
						case 'asc-sort' :
							ascSort();
							break;
						case 'des-sort' :
							desSort();
							break;
						case 'del-head-space' :
							delHeadSpace();
							break;
						case 'del-end-space' :
							delEndSpace();
							break;
					}
				countLineNumber();
				});
			});
		}
		function countLineNumber() {
			let lineCount = memoElm.innerText.match(/\n/g);
			lineCount = lineCount==null ? 1 : lineCount.length+1;
			let ln = '';
			for ( let i=1; i<=lineCount; i++) {
				ln += i + '\n';
			}
			document.getElementById('ln').innerText = ln;
		}
		function search() {
			if( document.getElementById('regex').checked ) {
				let flag = document.getElementById('case-sensitive').checked ? '' : 'i';
				flag += document.getElementById('replace-all').checked ? 'g' : '';
				let outputStrs = [];
				if ( document.getElementById('search-line').checked ) {
					let lines = memoElm.innerText.split(/\n/);
					for ( let line of lines ) {
						let replaceStr = '<span class="d--highlight">' + JSON.parse( "\"" + '$1' + "\"") + '</span>';
						line = line.replace(new RegExp('('+document.getElementById('search-str').value+')', flag), replaceStr);
						outputStrs.push(line);
					}
				} else {
					let replaceStr = '<span class="d--highlight">' + JSON.parse( "\"" + '$1' + "\"") + '</span>';
					let outputStr = memoElm.innerText.replace(new RegExp('('+document.getElementById('search-str').value+')', flag), replaceStr);
					outputStrs.push(outputStr);
				}
				memoElm.innerHTML = outputStrs.join('<br>');
			} else {
				alert('未実装');
			}
		}
		function replace() {
			if( document.getElementById('regex').checked ) {
				let flag = document.getElementById('case-sensitive').checked ? '' : 'i';
				flag += document.getElementById('replace-all').checked ? 'g' : '';
				let outputStrs = [];
				if ( document.getElementById('search-line').checked ) {
					let lines = memoElm.innerText.split(/\n/);
					let replaceStr = JSON.parse( "\"" + document.getElementById('replace-str').value.replace(/"/g,'\\"') + "\"");
					for ( let line of lines ) {
						line = line.replace(new RegExp(document.getElementById('search-str').value, flag), replaceStr);
						outputStrs.push(line);
					}
				} else {
					let replaceStr = JSON.parse( "\"" + document.getElementById('replace-str').value.replace(/"/g,'\\"') + "\"");
					let outputStr = memoElm.innerText.replace(new RegExp(document.getElementById('search-str').value, flag), replaceStr);
					outputStrs.push(outputStr);
				}
				memoElm.innerText = outputStrs.join('\n');
			} else {
				alert('未実装');
			}
		}
		function grep() {
			alert('未実装');
		}
		function fang() {
			memoElm.innerText = memoElm.innerText.replace(/h[tx][tx]p(s?)\[?:\]?\/\//g, 'http$1://').replace(/\[\.\]/g,'.').replace(/\[dot\]/g,'.');
		}
		function defang() {
			memoElm.innerText = memoElm.innerText.replace(/http(s?):\/\//g, 'hxxp$1[:]//').replace(/\./g,'[.]');
		}
		function delDupLine() {
			let lines = memoElm.innerText.split(/\n/);
			lines = [...new Set(lines)];
			memoElm.innerText = lines.join('\n');
		}
		function ascSort() {
			alert('未実装');
		}
		function desSort() {
			alert('未実装');
		}
		function delHeadSpace() {
			alert('未実装');
		}
		function delEndSpace() {
			alert('未実装');
		}
	</script>
</body>

</html>