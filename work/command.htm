<!DOCTYPE html>
<html lang="ja">
	<head>
		<meta charset="UTF-8">
		<meta name="author" content="Geppaku">
		<link rel="icon" href="favicon.ico">
		<link rel="stylesheet" href="../link.css">
		<title>LINK Tools</title>
	</head>
	<body>
		<svg class="l--display-none" xmlns="http://www.w3.org/2000/svg">
			<symbol viewBox="0 0 16 16" id="svg--copy">
				<path fill-rule="evenodd" d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zM2 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h1v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1v1z"/>
			</symbol>
			<symbol viewBox="0 0 16 16" id="svg--ext-link">
				<path fill-rule="evenodd" d="M8.636 3.5a.5.5 0 0 0-.5-.5H1.5A1.5 1.5 0 0 0 0 4.5v10A1.5 1.5 0 0 0 1.5 16h10a1.5 1.5 0 0 0 1.5-1.5V7.864a.5.5 0 0 0-1 0V14.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5"/>
				<path fill-rule="evenodd" d="M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793L6.146 9.146a.5.5 0 1 0 .708.708L15 1.707V5.5a.5.5 0 0 0 1 0z"/>
			</symbol>
		</svg>
		<h1 class="d--h1">Command</h1>
		<div class="l--padding-left--05 l--padding-right--05">
			<!--　■■■　SPLUNK　■■■　-->
			<details>
				<summary class="d--h2">Splunk</summary>
				<details>
					<summary class="d--h3">ログ量<button class="a--event-speaker d--no-border l--margin-left--1rem" data-act="search--splunk"><svg class="d--icon-btn"><use xlink:href="#svg--ext-link"></svg></button></summary>
					<div>
						<code contenteditable="true" class="l--full-width">
							index=_internal source=*license_usage.log type=usage idx=* <br>
							| eval GB = round(b/1024/1024/1024,2) <br>
							| timechart span=1d sum(GB) by idx
						</code>
					</div>
				</details>
			</details>
			<details>
				<summary class="d--h2">Splunk Tips</summary>
				<details>
					<summary class="d--h3">ログ量<button class="a--event-speaker d--no-border l--margin-left--1rem" data-act="search--splunk"><svg class="d--icon-btn"><use xlink:href="#svg--copy"></svg></button></summary>
					<div>
						<code contenteditable="true" class="l--full-width">
							index=_internal source=*license_usage.log type=usage idx=* <br>
							| eval GB = round(b/1024/1024/1024,2) <br>
							| timechart span=1d sum(GB) by idx
						</code>
					</div>
				</details>
				<details>
					<summary class="d--h3">フィールド抽出<button class="a--event-speaker d--no-border l--margin-left--1rem" data-act="search--splunk"><svg class="d--icon-btn"><use xlink:href="#svg--copy"></svg></button></summary>
					<div>
						<code contenteditable="true" class="l--full-width">
							| rex field=FIELD "(PREFIX)(?<NEW_FIELD>.*?)(SUFFIX)"
						</code>
					</div>
				</details>
				<details>
					<summary class="d--h3">正規表現で検索（NOT検索は不可）<button class="a--event-speaker d--no-border l--margin-left--1rem" data-act="search--splunk"><svg class="d--icon-btn"><use xlink:href="#svg--copy"></svg></button></summary>
					<div>
						<code contenteditable="true" class="l--full-width">
							| regex FIELD="REGEX"
						</code>
					</div>
				</details>
				<details>
					<summary class="d--h3">正規表現で検索（NOT検索も可）<button class="a--event-speaker d--no-border l--margin-left--1rem" data-act="search--splunk"><svg class="d--icon-btn"><use xlink:href="#svg--copy"></svg></button></summary>
					<div>
						<code contenteditable="true" class="l--full-width">
							| where match(FIELD,"REGEX")
						</code>
					</div>
				</details>
				<details>
					<summary class="d--h3">CIDR検索<button class="a--event-speaker d--no-border l--margin-left--1rem" data-act="search--splunk"><svg class="d--icon-btn"><use xlink:href="#svg--copy"></svg></button></summary>
					<div>
						<code contenteditable="true" class="l--full-width">
							| where cidrmatch("X.X.X.X/X",IP) OR cidrmatch("X.X.X.X/X",IP)
						</code>
					</div>
				</details>
				<details>
					<summary class="d--h3">UTCの _time をJSTに<button class="a--event-speaker d--no-border l--margin-left--1rem" data-act="search--splunk"><svg class="d--icon-btn"><use xlink:href="#svg--copy"></svg></button></summary>
					<div>
						<code contenteditable="true" class="l--full-width">
							| eval jst_time=strftime(_time-9*60*60,"%Y/%m/%d %H:%M:%S")
						</code>
					</div>
				</details>
			</details>
			<!--　■■■　NMAP　■■■　-->
			<details>
				<summary class="d--h2">NMAP</summary>
				<code contenteditable="true" class="l--full-width">
					nmap -Pn -sV --reason X.X.X.X(/X)<br>
					nmap -Pn -sU -sV --reason X.X.X.X(/X)
				</code>
				<table class="d--table-border-bottom--1">
					<tr>
						<td>-sU</td>
						<td>：</td>
						<td>UDPスキャン（-sV を付けないと結果が不安定）</td>
					</tr>
					<tr>
						<td>-p ポート番号</td>
						<td>：</td>
						<td>スキャンするポート番号を指定</td>
					</tr>
					<tr>
						<td>-g ポート番号</td>
						<td>：</td>
						<td>送信元ポート番号を指定</td>
					</tr>
					<tr>
						<td>-Pn</td>
						<td>：</td>
						<td>事前のホストスキャンを実施しない</td>
					</tr>
					<tr>
						<td>-sV</td>
						<td>：</td>
						<td>稼働サービスのバージョン情報取得（時間がかかる）</td>
					</tr>
					<tr>
						<td>-sS</td>
						<td>：</td>
						<td>TCPハーフコネクトスキャン（SYN/ACK応答にRSTを送る）</td>
					</tr>
					<tr>
						<td>-sT</td>
						<td>：</td>
						<td>TCPフルコネクトスキャン（ACK応答にRST/ACKを送り、コネクションを閉じる）</td>
					</tr>
					<tr>
						<td>-sP</td>
						<td>：</td>
						<td>存在するホストリストの取得（CIDR表記でネットワークを指定して実行可能）</td>
					</tr>
					<tr>
						<td>-O</td>
						<td>：</td>
						<td>OS情報取得</td>
					</tr>
					<tr>
						<td>-A</td>
						<td>：</td>
						<td>OS及びバージョン情報取得（かなり時間がかかる）</td>
					</tr>
					<tr>
						<td>-sA</td>
						<td>：</td>
						<td>ファイアーウォールで保護されているか確認（ポートが空いているかは分からない）</td>
					</tr>
					<tr>
						<td>-sC</td>
						<td>：</td>
						<td>標準的なスクリプトスキャン</td>
					</tr>
					<tr>
						<td>--script banner.nse</td>
						<td>：</td>
						<td>TCPポートに接続して、バナー情報を得る</td>
					</tr>
					<tr>
						<td>--script ftp-anon.nse</td>
						<td>：</td>
						<td>FTPサーバーにanonymousアカウントでログイン可能か表示する</td>
					</tr>
					<tr>
						<td>-iL ファイル名</td>
						<td>：</td>
						<td>ホスト/ネットワークのリストを読み込む</td>
					</tr>
					<tr>
						<td>-oN ファイル名</td>
						<td>：</td>
						<td>結果をファイルに書き出す</td>
					</tr>
					<tr>
						<td>-vv</td>
						<td>：</td>
						<td>詳細情報の表示（NMAPバージョンも表示される）</td>
					</tr>
				</table>
				<table>
					<tr>
						<td>Open</td>
						<td>：</td>
						<td>TCP wrapper（tcpd）で制御されていた場合、Openとなることがある</td>
					</tr>
					<tr>
						<td>Filtered</td>
						<td>：</td>
						<td>iptablesで制御されていた場合、Filteredとなる</td>
					</tr>
					<tr>
						<td>Closed</td>
						<td>：</td>
						<td>RSTが返ってきた場合</td>
					</tr>
				</table>
			</details>
			<!--　■■■　BASH　■■■　-->
			<details>
				<summary class="d--h2">Bash</summary>
				<details>
					<summary class="d--h3">60秒毎にコマンド実行し、日時付で画面＆ファイル出力</summary>
					<code contenteditable="true" class="l--full-width">
						watch -d -n 60 'echo -e `date`"\n****************"`コマンド`"\n****************\n\n" | tee -a output.txt'
					</code>
				</details>
				<details>
					<summary class="d--h3">リモートから/リモートへのSCP</summary>
					<code contenteditable="true" class="l--full-width">
						【リモート→ローカル】scp user@xxx.xxx.xxx.xxx:~/file.txt ./<br>
						【ローカル→リモート】scp file.txt user@xxx.xxx.xxx.xxx:~/
					</code>
				</details>
			</details>
			<!--　■■■　●●　■■■　-->
			<details>
				<summary class="d--h2">●●</summary>
				<details>
					<summary class="d--h3">●●</summary>
					<code contenteditable="true" class="l--full-width">
						●●
					</code>
				</details>
			</details>
		</div>

		<script>
			document.querySelectorAll('.a--event-speaker').forEach(function(elm) {
				elm.addEventListener('click', function() {
					switch(elm.dataset.act) {
						case 'search--splunk' :
							searchSplunk(elm);
						break;
						case 'copy' :
							copy(elm);
						break;
					}
				});
			});
			function searchSplunk(elm) {
				splunkUrl = '';
				let spl = elm.parentElement.nextElementSibling.children[0].textContent.replace(/\t/g,'').trim();
				window.open(splunkUrl + encodeURIComponent(spl));
			}
			function copy(elm) {
				navigator.clipboard.writeText(elm.parentElement.nextElementSibling.children[0].textContent.replace(/\t/g,'').trim());
			}
		</script>
	</body>
</html>
